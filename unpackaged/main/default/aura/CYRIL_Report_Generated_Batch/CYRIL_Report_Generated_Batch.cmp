<aura:component controller="CYRIL_Report_Generated_Batch" 
                implements="force:appHostable,lightning:isUrlAddressable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:lightningQuickActionWithoutHeader,force:hasRecordId,forceCommunity:availableForAllPageTypes,lightning:actionOverride" access="global">
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/> 
    <aura:attribute name="reports" type="Object"/>
    <aura:attribute name="batches" type="Object"/>
    <aura:attribute name="title" type="String" default="Report Generated Batchable"/>
    <aura:attribute name="reportId" type="String"/>
    <aura:attribute name="column" type="String" default="1"/>
    <aura:attribute name="fields" type="String"/>
    <aura:attribute name="filters" type="String"/>
    <aura:attribute name="batchId" type="String"/>
    <aura:attribute name="batchSize" type="String" default="2"/>
    
    <aura:attribute name="apexJob" type="Object"/>

    <aura:attribute name="cloading" type="Boolean" default="true"/>
    <aura:attribute name="cerror" type="Boolean" default="false"/>
    <aura:attribute name="cerrormsg" type="String"/>
    
    <article class="slds-card cyril-card cyril-report-batchable" id="cyril-report-batchable">
        <div class="slds-card__header slds-grid" style="padding-bottom: 15px;">
            <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <div class="slds-media__figure" style="float: left;">
                    <span class="slds-icon_container slds-icon-standard-contact_list" title="List">
                        <lightning:icon iconName="standard:product_request" alternativeText="List" title="List" />
                        
                        <span class="slds-assistive-text">List</span>
                    </span>
                </div>
                <div class="slds-media__body">
                    <h2 class="slds-card__header-title">
                        <span>{!v.title}</span>
                    </h2>
                </div>
            </header>
        </div>

        <div class="slds-card__body slds-card__body_inner">

            <aura:if isTrue="{!v.cloading==true}">
                <div class="exampleHolder">
                    <lightning:spinner alternativeText="Loading" size="small" />
                </div>
            </aura:if>
            <aura:if isTrue="{!v.cerror==true}">
                <div class="slds-notify slds-notify_alert slds-alert_error" role="alert" style="width: 100%;">
                    <h2>{!v.cerrormsg}</h2>
                </div>
            </aura:if>

            <aura:if isTrue="{!v.apexJob!=null}">

                <div class="slds-notify slds-notify_alert slds-alert_warning" role="alert" style="margin: 10px 0;">
                    <p>
                        Apex Job [{!v.apexJob.Id}] is <b>{!v.apexJob.Status}</b>. 
                        <lightning:buttonIcon iconName="utility:refresh" variant="bare" onclick="{! c.refreshApexJob }" alternativeText="Refresh" />
                        <lightning:buttonIcon iconName="utility:new_window" variant="bare" onclick="{! c.openTab }" alternativeText="Open" />
                    </p>
                   	
                </div>
                
                


                <!-- <h2>Apex Job</h2>
                <p class="slds-truncate">Id: {!v.apexJob.Id} &nbsp;

                </p>
                <p class="slds-truncate">Status: {!v.apexJob.Status}</p>
                <p class="slds-truncate">Status Detail: {!v.apexJob.ExtendedStatus}</p>
                <p class="slds-truncate">Total Job Items: {!v.apexJob.TotalJobItems}</p>
                <p class="slds-truncate">Job Items Processed: {!v.apexJob.JobItemsProcessed}</p>
                <p class="slds-truncate">Number Of Errors: {!v.apexJob.NumberOfErrors}</p> -->
            </aura:if>

            <aura:if isTrue="{!empty(v.recordId)}">
                <div class="row">
                    <lightning:select class="slds-m-top_small" label="Which Report?" value="{!v.reportId}" required="true">
                        <option text="--Choose Report To Process--" value=""/>
                        <aura:iteration items="{!v.reports}" var="option">
                            <option text="{!option.Name}" value="{!option.Id}"/>
                        </aura:iteration>
                    </lightning:select>
                    <small>Report should not exceed 50,000 rows.</small><br/>
                    <lightning:input type="text" value="{!v.column}" label="Column Number of Id/Record Source" required="true"/>
                    <lightning:input type="text" value="{!v.fields}" label="Fields to fetch (If supported by Batchable. Use comma to separate. leave empty to use batchable default.)" />
                    <lightning:input type="text" value="{!v.filters}" label="Additional SOQL Filter (If supported by Batchable. Leave empty to use batchable default.)" />
                    
                    <lightning:select name="select1" label="Which Batchable?" value="{!v.batchId}" required="true">
                        <option value="">--Choose one--</option>
                        <aura:iteration items="{!v.batches}" var="option">
                            <option text="{!option.MasterLabel}" value="{!option.Id}"/>
                        </aura:iteration>
                    </lightning:select>
                    <lightning:input type="text" value="{!v.batchSize}" label="Batch size" />
                    
                    <lightning:button class="slds-m-top_small slds-align_absolute-center" variant="brand" 
                                    label="Execute"
                                    title="Execute"
                                    onclick="{! c.ExecuteBatch }"/> 
                </div>
            </aura:if>

        </div>
    </article>
</aura:component>